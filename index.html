<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Anmeldung Konjunkturumfrage</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #99CAD5;
      margin: 0;
      padding: 2rem;
    }
    .form-section {
      display: none;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      max-width: 600px;
      margin: auto;
    }
    .form-section.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #007099;
      color: white;
      font-weight: bold;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

  <form id="anmeldungForm">

    <!-- Firma -->
    <div id="firmaSection" class="form-section active">
      <h2>Angaben zur Firma</h2>
      <label for="firma">Firmenname</label>
      <input type="text" id="firma" name="firma" autocomplete="off" list="firmaListe" required>
      <datalist id="firmaListe"></datalist>

      <label for="uid">UID</label>
      <input type="text" id="uid" name="uid" readonly>

      <label for="adresse">Firmenadresse</label>
      <input type="text" id="adresse" name="adresse" readonly>

      <label for="plz">Postleitzahl</label>
      <input type="text" id="plz" name="plz" readonly>

      <label for="ort">Ort</label>
      <input type="text" id="ort" name="ort" readonly>

      <button type="button" onclick="nextSection('firmaSection', 'kontaktSection')">Bestätigen</button>
    </div>

    <!-- Kontaktperson -->
    <div id="kontaktSection" class="form-section">
      <h2>Angaben zur Kontaktperson</h2>
      <label for="anrede">Anrede</label>
      <select id="anrede" name="anrede">
        <option>Herr</option>
        <option>Frau</option>
      </select>

      <label for="titel">Titel</label>
      <input type="text" id="titel" name="titel">

      <label for="vorname">Vorname</label>
      <input type="text" id="vorname" name="vorname" required>

      <label for="nachname">Nachname</label>
      <input type="text" id="nachname" name="nachname" required>

      <label for="funktion">Abteilung/Funktion</label>
      <input type="text" id="funktion" name="funktion">

      <label for="email">E-Mail</label>
      <input type="email" id="email" name="email" required>

      <label for="telefon">Telefon</label>
      <input type="tel" id="telefon" name="telefon">

      <label for="mobile">Mobile</label>
      <input type="tel" id="mobile" name="mobile">

      <button type="button" onclick="nextSection('kontaktSection', 'unternehmenSection')">Bestätigen</button>
    </div>

    <!-- Unternehmensangaben -->
    <div id="unternehmenSection" class="form-section">
      <h2>Unternehmensangaben</h2>
      <div id="branchenContainer">
        <div class="branche">
          <label>NOGA Branche 1</label>
          <input type="text" class="noga" list="nogaList">
          <input type="number" placeholder="Anzahl Mitarbeiter">
        </div>
        <div class="branche">
          <label>NOGA Branche 2</label>
          <input type="text" class="noga" list="nogaList">
          <input type="number" placeholder="Anzahl Mitarbeiter">
        </div>
        <div class="branche">
          <label>NOGA Branche 3</label>
          <input type="text" class="noga" list="nogaList">
          <input type="number" placeholder="Anzahl Mitarbeiter">
        </div>
      </div>
      <datalist id="nogaList"></datalist>
      <button type="button" onclick="nextSection('unternehmenSection', 'bemerkungenSection')">Bestätigen</button>
    </div>

    <!-- Bemerkungen -->
    <div id="bemerkungenSection" class="form-section">
      <h2>Bemerkungen</h2>
      <label for="bemerkungen">Ihre Bemerkungen</label>
      <textarea id="bemerkungen" name="bemerkungen" rows="5"></textarea>

      <button type="submit">Senden</button>
    </div>

  </form>

  <script>
    function nextSection(current, next) {
      document.getElementById(current).classList.remove('active');
      document.getElementById(next).classList.add('active');
    }

    // Zefix Autocomplete API – simuliert mit Beispielnamen
    document.getElementById('firma').addEventListener('input', async function () {
      const query = this.value;
      if (query.length < 3) return;
      const resp = await fetch(`https://www.zefix.ch/ZefixREST/api/v1/company/search?name=${encodeURIComponent(query)}`);
      if (!resp.ok) return;
      const data = await resp.json();

      const liste = document.getElementById('firmaListe');
      liste.innerHTML = '';
      data.companies?.forEach(entry => {
        const option = document.createElement('option');
        option.value = entry.name;
        option.dataset.uid = entry.uid;
        liste.appendChild(option);
      });
    });

    document.getElementById('firma').addEventListener('change', async function () {
      const name = this.value;
      const option = Array.from(document.getElementById('firmaListe').options).find(opt => opt.value === name);
      if (!option) return;
      const uid = option.dataset.uid;
      document.getElementById('uid').value = uid;
      const resp = await fetch(`https://www.zefix.ch/ZefixREST/api/v1/company/uid/${uid}`);
      const data = await resp.json();
      if (!data || !data.address) return;
      document.getElementById('adresse').value = `${data.address.street} ${data.address.houseNumber || ''}`;
      document.getElementById('plz').value = data.address.zip;
      document.getElementById('ort').value = data.address.city;
    });

    // Beispielhafte NOGA-Liste (simuliert)
    const nogaCodes = [
      { code: '011100', name: 'Anbau von Getreide (ohne Reis), Hülsenfrüchten und Ölsaaten' },
      { code: '620100', name: 'Erbringung von Dienstleistungen der Informationstechnologie' },
      { code: '471100', name: 'Detailhandel in nicht spezialisierten Geschäften' }
    ];

    const nogaList = document.getElementById('nogaList');
    nogaCodes.forEach(noga => {
      const opt = document.createElement('option');
      opt.value = `${noga.code} - ${noga.name}`;
      nogaList.appendChild(opt);
    });
  </script>

</body>
</html>

